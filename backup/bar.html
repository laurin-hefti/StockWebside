<!DOCTYPE html>
<head>
    <meta charset="UTF-8">
    <title> Bar </title>

    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>


    <style>
        :root {
            --background-color: black;
            --text-color: white;
        }

        h1 {
            color: var(--text-color);
            text-align: center;
        }

        button {
            margin: 5px;
        }

        .drinkElement {
            color: var(--text-color);
            margin: 15px;
        }

        .drinkmodifybutton {
            margin: 5px;
            width: 30px;
        }

        .drinkmodifybutton:hover{
            background-color: gray;
        }
    </style>
</head>

<body style = "background-color: var(--background-color);">
    <h1 class="conatiner mt-5">Bar</h1>

    <div class="conatiner mt-5">
        <button class="btn btn-dark" id="homeLink">home</button>
        <button class="btn btn-dark" id="dataLink">data</button>
        <button class="btn btn-dark" id="statisticLink">statistics</button>
    </div>

    <!--content the page-->
    <div class="container mt-4">
        <div id="homeContent">
            <h1>Bar menu</h1>
            <div id="drinkOptionList"></div>
        </div>

        <div id="dataContent">
            <h1>Settings</h1>
            <div id="drinkSettingsList"></div>
            <button class="btn btn-dark" id="newTimeButton">new Time</button>
            <button class="btn btn-dark" id="randomData">generate random Data</button>
        </div>

        <div id="statisticContent">
            <h1>statistics</h1>
            <div id="drinkStatisticList"></div>
        </div>

    </div>

    <script>
        async function sendToStockServer(input_data, func){
            await fetch("http://localhost:3003", {
                method: "POST",
                headers: {"Content-Type": "application/json"},
                body: JSON.stringify(input_data)
            }).then(response => {
                if (!response.ok){
                    console.log("error with getting data from 3003");
                } else {
                    return response.json();
                }
            }).then(data => {
                func(data);
            });
        }

        $(document).ready(function() {
            $("#dataContent").hide();
            $("#statisticContent").hide();

            $("#homeLink").click(function(){
                $("#homeContent").show();
                $("#dataContent").hide();
                $("#statisticContent").hide();
            });

            $("#dataLink").click(function() {
                $("#dataContent").show();
                $("#homeContent").hide();
                $("#statisticContent").hide();
            });

            $("#statisticLink").click(function() {
                $("#statisticContent").show();
                $("#dataContent").hide();
                $("#homeContent").hide();
            });

            $("#newTimeButton").click(function(){
                sendToStockServer("newTimeStamp", (data)=>{location.reload();});
            });

            $("#randomData").click(function () {
                sendToStockServer("randomData", (data)=>{});
            });
            
            //realoade the page

            async function setDrinkData(){
                await fetch("http://localhost:3001").then(response => {
                    if (!response.ok) {
                        console.log("error with receaving data form 3001");
                    } else {
                        return response.json();
                    }
                }).then(data =>{
                    var dl = document.getElementById("drinkOptionList");

                    data.drinks.forEach(element => {
                        let drinkdiv = document.createElement("h3");
                        
                        // display name and price of every drink
                        drinkdiv.classList.add("drinkElement");
                        drinkdiv.textContent = element.name + " " + element.prices[element.prices.length-1];
                        dl.appendChild(drinkdiv);

                        // create the buttons to modyfy the drink
                        let buttonadddrink = document.createElement("div");
                        buttonadddrink.textContent = "+";
                        buttonadddrink.classList.add("drinkmodifybutton");
                        buttonadddrink.addEventListener("click", function() {
                            sendToStockServer("buy," + element.name, (data)=>{});});
                        drinkdiv.appendChild(buttonadddrink);

                        let buttonremovedrink = document.createElement("div");
                        buttonremovedrink.textContent = "-";
                        buttonremovedrink.classList.add("drinkmodifybutton");
                        buttonremovedrink.addEventListener("click", function() {
                            sendToStockServer("sell,"+element.name, (data)=>{});});
                        drinkdiv.appendChild(buttonremovedrink);
                    });
                });
            }

            async function setDrinkSettings(){
                async function processData(data){
                    let settingsdiv = document.getElementById("drinkSettingsList");
                    for (let drink of data.drinks){
                        let drinkdiv = document.createElement("h3");
                        drinkdiv.textContent = drink.name;
                        drinkdiv.classList.add("drinkElement");
                        settingsdiv.appendChild(drinkdiv);
                        
                        let mindiv = document.createElement("h3");
                        mindiv.textContent = "min Price : " + drink.minPrice;
                        mindiv.classList.add("drinkElement");
                        drinkdiv.appendChild(mindiv);

                        let maxdiv = document.createElement("h3");
                        maxdiv.textContent = "max Price : " + drink.maxPrice;
                        maxdiv.classList.add("drinkElement");
                        drinkdiv.appendChild(maxdiv);

                    }
                }

                await sendToStockServer("getJsonSetings", processData);
            }

            async function setDrinkStatistics(){
                async function processData(data){
                    let statisticsdiv = document.getElementById("drinkStatisticList");
                    for(let drink of data.drinks){
                        let drinkdiv = document.createElement("h3");
                        drinkdiv.textContent = drink.name;
                        drinkdiv.classList.add("drinkElement");
                        statisticsdiv.appendChild(drinkdiv);

                        let total_sales = document.createElement("h3");
                        total_sales.textContent = "verkauft : " + drink.totalSels;
                        total_sales.classList.add("drinkElement");
                        drinkdiv.appendChild(total_sales);

                        let durchschnit_verkauft = drink.totalMony / drink.totalSels;
                        if (drink.totalSels == 0){
                            durchschnit_verkauft = 0;
                        }
                        let ratio = document.createElement("h3");
                        ratio.textContent = "durchschnit StÃ¼ckpreis : " + durchschnit_verkauft;
                        ratio.classList.add("drinkElement");
                        drinkdiv.appendChild(ratio); 
                    }
                }

                await sendToStockServer("getJsonStatistics", processData);
            }

            //making a function
            setDrinkData().then(() => setDrinkSettings()).then(() => setDrinkStatistics());
        });
    </script>
</body>